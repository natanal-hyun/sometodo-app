# Some To Do - ì¼ì •, ê°€ê³„ë¶€ ê´€ë¦¬ ì•±

## ğŸ’¡ 1. í”„ë¡œì íŠ¸ ê°œìš”

### ğŸ“Œ í”„ë¡œì íŠ¸ëª…  
**SomeToDo** â€“ ì¼ì • ë° ê°€ê³„ë¶€ ê´€ë¦¬ í†µí•© ì•±

### ğŸ¯ ëª©ì   
í•˜ë£¨ì˜ ìŠ¤ì¼€ì¤„ê³¼ ì§€ì¶œ ë‚´ì—­ì„ í•œ ê³³ì—ì„œ ê´€ë¦¬í•  ìˆ˜ ìˆë„ë¡ ë•ëŠ” í†µí•©í˜• ëª¨ë°”ì¼ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œ  
â†’ ì‚¬ìš©ì ì¤‘ì‹¬ì˜ **ê°„í¸í•œ UI/UX**, **ê³„ì • ì¸ì¦ ë° ë³´ì•ˆ**, **ë°ì´í„° ì €ì¥ ë° ì—°ë™**ì— ì¤‘ì ì„ ë‘ì–´ ì„¤ê³„

### ğŸ•’ ê°œë°œ ê¸°ê°„  
**2024. 02. 25 ~ 2024. 03. 28 (ì•½ 5ì£¼)**

| ì£¼ì°¨       | ì£¼ìš” ë‚´ìš© |
|------------|-----------|
| **1ì£¼ì°¨** | ì£¼ì œ ì„ ì • ë° ìš”êµ¬ì‚¬í•­ ë¶„ì„, ì£¼ìš” ê¸°ëŠ¥ ê¸°íš ë° ê¸°ìˆ  ìŠ¤íƒ ê²°ì • |
| **2~3ì£¼ì°¨** | ê°œì¸ë³„ íŒŒíŠ¸ ë¶„ë‹´ ë° ê¸°ëŠ¥ë³„ ì„¤ê³„, í™”ë©´ UI ì´ˆì•ˆ ì œì‘, ê¸°ëŠ¥ ë‹¨ìœ„ ê°œë°œ ì§„í–‰ |
| **4ì£¼ì°¨** | ì½”ë“œ í†µí•© ë° í™”ë©´ ì—°ë™, API ì—°ê²° í…ŒìŠ¤íŠ¸, ì˜ˆì™¸ ì²˜ë¦¬ ë° ì˜¤ë¥˜ ìˆ˜ì • |
| **5ì£¼ì°¨** | ë””ë²„ê¹… ë° ì„±ëŠ¥ ê°œì„ , AWS EC2ë¥¼ í†µí•œ ë°°í¬, í”„ë¡œì íŠ¸ ë¬¸ì„œ ì •ë¦¬ ë° ë°œí‘œ ì¤€ë¹„ |

### ğŸ§‘â€ğŸ’» íŒ€ êµ¬ì„± (ì´ 3ì¸)
| ì´ë¦„       | ì—­í•                | ì£¼ìš” ë‹´ë‹¹ ê¸°ëŠ¥ |
|------------|--------------------|----------------|
| ì—„ì •í˜„ (ë³¸ì¸) | **ê³„ì • íŒŒíŠ¸ ê°œë°œ**     | íšŒì›ê°€ì…, ë¡œê·¸ì¸, JWT ì¸ì¦, êµ¬ê¸€ ë¡œê·¸ì¸, í”„ë¡œí•„ ê´€ë¦¬ |
| [ë°±ê±´ìš°](https://github.com/gunwoo100/project_schedule)     | ì¼ì • ê¸°ëŠ¥ ê°œë°œ         | ì¼ì • ë“±ë¡, ì¡°íšŒ, ìˆ˜ì •, ì‚­ì œ ë° UI êµ¬ì„± |
| [ê¹€ì§€ìš±](https://github.com/orangetunnelkim/moneyFlow)     | ê°€ê³„ë¶€ ê¸°ëŠ¥ ê°œë°œ      | ì§€ì¶œ ë“±ë¡, í†µê³„ í™”ë©´, ê°€ê³„ë¶€ UI ë° ë°±ì—”ë“œ ë¡œì§ |

### ğŸ›  ê¸°ìˆ  ìŠ¤íƒ
- **Frontend**: Android (Java), Retrofit2, Glide, SharedPreferences  
- **Backend**: Spring Boot, Spring Security, JPA, PostgreSQL, JWT

---

## âœ… 2. í•µì‹¬ ê¸°ëŠ¥ ìš”ì•½

ì´ í”„ë¡œì íŠ¸ì˜ ê³„ì • íŒŒíŠ¸ëŠ” ì‚¬ìš©ì ì¸ì¦ ë° ì •ë³´ ê´€ë¦¬ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì€ í•µì‹¬ ê¸°ëŠ¥ì„ í¬í•¨í•©ë‹ˆë‹¤. ê° ê¸°ëŠ¥ì€ ì´ë¯¸ì§€ ë˜ëŠ” gifì™€ í•¨ê»˜ ì§ê´€ì ìœ¼ë¡œ ì´í•´í•  ìˆ˜ ìˆë„ë¡ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

---

### 1ï¸âƒ£ ë¡œê·¸ì¸ í™”ë©´ (ğŸ“± Android í™”ë©´)

- **ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ë˜ëŠ” êµ¬ê¸€ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ ê°€ëŠ¥**
- **ì…ë ¥ê°’ ìœ íš¨ì„± ê²€ì‚¬ ë° ë¡œê·¸ì¸ ì‹¤íŒ¨ ì•ˆë‚´ ì²˜ë¦¬**
- ë¡œê·¸ì¸ ì„±ê³µ ì‹œ, ìë™ìœ¼ë¡œ JWT í† í° ì €ì¥

<div align="center">
  <img src="https://github.com/user-attachments/assets/becbf6b5-96e0-4f6c-8c58-77011824a966" alt="ë¡œê·¸ì¸ í™”ë©´" width="300">
</div>

---

### 2ï¸âƒ£ íšŒì›ê°€ì… í™”ë©´

- **ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸, ë‹‰ë„¤ì„ ì…ë ¥ë§Œìœ¼ë¡œ ê°„í¸ ê°€ì…**
- **ì…ë ¥ê°’ ìœ íš¨ì„± + ì´ë©”ì¼/ë‹‰ë„¤ì„ ì¤‘ë³µ ê²€ì‚¬ í¬í•¨**
- íšŒì›ê°€ì… ì„±ê³µ ì‹œ ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™

<div align="center">
  <img src="https://github.com/user-attachments/assets/cb9fcce7-2b97-4190-923e-14f2404e2bf8" alt="íšŒì›ê°€ì… í™”ë©´" width="300">
</div>

---

### 3ï¸âƒ£ ì„¤ì • í˜ì´ì§€

- **í”„ë¡œí•„ ë³´ê¸°, ìˆ˜ì •, ë¹„ë°€ë²ˆí˜¸ ë³€ê²½, ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥ ì œê³µ**
- í•˜ë‹¨ ë©”ë‰´ì˜ â€˜ì„¤ì •â€™ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥

<div align="center">
  <img src="https://github.com/user-attachments/assets/39edc96b-8091-4f33-beb9-83153d404007" alt="ì„¤ì • í™”ë©´" width="300">
</div>

---

### 4ï¸âƒ£ í”„ë¡œí•„ ìˆ˜ì • í™”ë©´

- **ë‹‰ë„¤ì„, ìƒíƒœ ë©”ì‹œì§€, í”„ë¡œí•„ ì´ë¯¸ì§€ ìˆ˜ì • ê°€ëŠ¥**
- ìˆ˜ì • í›„ì—ëŠ” ë³€ê²½ëœ ë‚´ìš©ì„ ë°˜ì˜í•œ ìƒˆë¡œìš´ Access Token ë°œê¸‰

<div align="center">
  <img src="https://github.com/user-attachments/assets/dd0f74f2-0485-4991-a069-b88364005d1d" alt="í”„ë¡œí•„ ìˆ˜ì • í™”ë©´" width="300">
</div>

---

### 5ï¸âƒ£ êµ¬ê¸€ ë¡œê·¸ì¸ (ì†Œì…œ ë¡œê·¸ì¸)

- **Firebase ì—†ì´ Google OAuth2.0ìœ¼ë¡œ êµ¬í˜„**
- **idTokenì„ ë°›ì•„ ë°±ì—”ë“œì—ì„œ ê²€ì¦ ë° ìë™ íšŒì›ê°€ì… ì²˜ë¦¬**
- ì´ë©”ì¼ ì¤‘ë³µ ì‹œ ê¸°ì¡´ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ ì‹¤íŒ¨ ì²˜

<div align="center">
  <img src="https://github.com/user-attachments/assets/ccdccd4a-5486-4c55-b1b8-39bb65c7ce72" alt="êµ¬ê¸€ ë¡œê·¸ì¸ í™”ë©´" width="300">
</div>

---

### ğŸ” ì°¸ê³ 

- ì´ ì„¹ì…˜ì€ **ì£¼ìš” ê¸°ëŠ¥ì˜ êµ¬ì¡°ì™€ íë¦„ì„ ì‹œê°ì ìœ¼ë¡œ ë³´ì—¬ì£¼ëŠ” ì—­í• **ì„ í•©ë‹ˆë‹¤.
- ì‹¤ì œ ë™ì‘ ì¥ë©´ì„ ìì„¸íˆ ë³´ê³  ì‹¶ë‹¤ë©´ ì•„ë˜ì˜ **4. ì‹œì—° ì˜ìƒ** ì„¹ì…˜ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## âœ¨ 3. ê¸°ëŠ¥ êµ¬í˜„

ê³„ì • íŒŒíŠ¸ì—ì„œ êµ¬í˜„í•œ ì£¼ìš” ê¸°ëŠ¥ë“¤ì„ ì‹¤ì œ íë¦„ì— ë§ì¶° ì„¤ëª…í•˜ê³ , ê° ê¸°ëŠ¥ì˜ êµ¬í˜„ ë°©ì‹ì„ ê°„ë‹¨íˆ ì†Œê°œí•©ë‹ˆë‹¤.

---

### âœ… íšŒì›ê°€ì…

- **Android**
   - ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸, ë‹‰ë„¤ì„ì„ ì…ë ¥ë°›ê³  **ìœ íš¨ì„± ê²€ì‚¬**ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.
   - ì…ë ¥ê°’ í™•ì¸ í›„ `SignupRequest` DTOë¥¼ ìƒì„±í•˜ì—¬ ì„œë²„ì— ì „ì†¡í•©ë‹ˆë‹¤.  
   - ì„œë²„ ì‘ë‹µì— ë”°ë¼ ì„±ê³µ ë©”ì‹œì§€ë¥¼ ì¶œë ¥í•˜ê±°ë‚˜ ì‹¤íŒ¨ ì•Œë¦¼ì„ ë„ì›ë‹ˆë‹¤.
  
   ```java
    public void onSignupButtonClick(View view) {
        String email = etEmail.getText().toString().trim();
        String password = etPassword.getText().toString().trim();
        String nickname = etNickname.getText().toString().trim();

        // âœ… ìœ íš¨ì„± ê²€ì‚¬ (ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸, ë‹‰ë„¤ì„) â€” ìƒëµ ê°€ëŠ¥
        if (isInvalidInput(email, password, nickname)) return;

        SignupRequest signupRequest = new SignupRequest(email, password, password, nickname);
        AuthApiService api = RetrofitClient.getClient().create(AuthApiService.class);
        api.signup(signupRequest).enqueue(new Callback<Void>() {
            @Override
            public void onResponse(Call<Void> call, Response<Void> response) {
                if (response.isSuccessful()) {
                    finish(); // ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™
                }
            }
            ...
        });
    }
   ```

- **Backend**
   - ì´ë©”ì¼ ë° ë‹‰ë„¤ì„ **ì¤‘ë³µ ê²€ì‚¬**
   - ë¹„ë°€ë²ˆí˜¸ **BCrypt ì•”í˜¸í™”** í›„ ì €ì¥
   - `Account` / `Profile` í…Œì´ë¸”ì— ë¶„ë¦¬ ì €ì¥

    ```java
    if (accountRepository.existsByEmail(request.getEmail()))
       throw new IllegalArgumentException("ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤.");
    if (profileRepository.existsByNickname(request.getNickname()))
       throw new IllegalArgumentException("ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.");

    Account account = Account.builder()
          .email(request.getEmail())
          .password(passwordEncoder.encode(request.getPassword())) // âœ… ì•”í˜¸í™”
          .build();

    accountRepository.save(account);
    ```
  ğŸ‘‰ ìœ„ ì½”ë“œ ì´í›„ì— Profileë„ accountì™€ ì—°ê²°í•´ ì €ì¥ë©ë‹ˆë‹¤.

---

### âœ… ë¡œê·¸ì¸

#### ğŸ”¹ Android (LoginActivity)

- ì‚¬ìš©ìê°€ ì…ë ¥í•œ **ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ì˜ ìœ íš¨ì„± ê²€ì‚¬** í›„, `LoginRequest` ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ ì„œë²„ì— ì „ë‹¬í•©ë‹ˆë‹¤.
- ì‘ë‹µì´ ì„±ê³µì ì¼ ê²½ìš° `Access Token`ê³¼ `Refresh Token`ì„ `TokenManager`ì— ì €ì¥í•˜ê³  ë¡œê·¸ì¸ ì„±ê³µ ì²˜ë¦¬ë¥¼ í•©ë‹ˆë‹¤.

    ```java
    if (!email.isEmpty() && !password.isEmpty()) {
        Call<LoginResponse> call = apiService.login(new LoginRequest(email, password));
        call.enqueue(new Callback<>() {
            public void onResponse(...) {
                if (response.isSuccessful()) {
                    loginSuccess(response.body()); // âœ… TokenManagerì— ì €ì¥
                }
            }
        });
    }
    ```

ğŸ‘‰ `loginSuccess()` ë©”ì„œë“œ ë‚´ë¶€ì—ì„œ í† í° ì €ì¥ ë° í™”ë©´ ì „í™˜ ì²˜ë¦¬

---

#### ğŸ”¹ Backend (LoginService)

1. **ì´ë©”ì¼ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸**
2. **ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ ì—¬ë¶€ í™•ì¸**
3. ì„±ê³µ ì‹œ `Access Token`ê³¼ `Refresh Token`ì„ ìƒì„±í•˜ê³  ì‘ë‹µ

    ```java
    Account account = accountRepository.findByEmail(request.getEmail())
       .orElseThrow(() -> new IllegalArgumentException("ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜"));

    if (!passwordEncoder.matches(request.getPassword(), account.getPassword())) {
       throw new IllegalArgumentException("ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜");
    }
    ```

ğŸ‘‰ ì´í›„ ì•„ë˜ì™€ ê°™ì´ í† í°ì„ ìƒì„± ë° ì €ì¥í•©ë‹ˆë‹¤:

    ```java
    String accessToken = jwtUtil.generateAccessToken(userResponse);
    String refreshToken = jwtUtil.generateRefreshToken(userResponse);

    // ê¸°ì¡´ RefreshToken ê°±ì‹  or ìƒˆë¡œ ì €ì¥
    Optional<RefreshToken> existing = refreshTokenRepository.findByAccount(account);
    existing.ifPresentOrElse(
       token -> {
          token.setToken(refreshToken);
          token.setExpirationDate(...);
          refreshTokenRepository.save(token);
       },
       () -> refreshTokenRepository.save(new RefreshToken(...))
    );
    ```

---

### âœ… JWT í† í° ê´€ë¦¬

> JWT ê¸°ë°˜ ì¸ì¦ ì‹œìŠ¤í…œì€ **í† í°ì„ ì´ìš©í•œ ë¬´ìƒíƒœ(stateless) ì¸ì¦ ë°©ì‹**ì…ë‹ˆë‹¤. ì´ í”„ë¡œì íŠ¸ì—ì„œëŠ” Androidì—ì„œëŠ” Interceptorë¡œ, Spring Bootì—ì„œëŠ” JwtUtil í´ë˜ìŠ¤ë¥¼ í†µí•´ ê°ê° í† í°ì„ ì£¼ê³ ë°›ê³  ê´€ë¦¬í•˜ëŠ” êµ¬ì¡°ë¥¼ ê°–ìŠµë‹ˆë‹¤

---

#### ğŸ“± **Interceptor (Android)**  
**`AuthInterceptor`** í´ë˜ìŠ¤ëŠ” ëª¨ë“  HTTP ìš”ì²­ì— ëŒ€í•´ ë‹¤ìŒê³¼ ê°™ì€ ì—­í• ì„ í•©ë‹ˆë‹¤:

- 1. **Authorization í—¤ë” ìë™ ì¶”ê°€**  
   ì‚¬ìš©ìê°€ ë¡œê·¸ì¸í•  ë•Œ ë°œê¸‰ë°›ì€ Access Tokenì„ SharedPreferencesì—ì„œ êº¼ë‚´ì™€, ë§¤ ìš”ì²­ë§ˆë‹¤ `Authorization: Bearer <Access Token>` í˜•ì‹ìœ¼ë¡œ ìš”ì²­ í—¤ë”ì— ìë™ìœ¼ë¡œ ì¶”ê°€í•©ë‹ˆë‹¤. ì´ë¡œì¨ API ìš”ì²­ë§ˆë‹¤ í† í°ì„ ìˆ˜ë™ìœ¼ë¡œ ë¶™ì´ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤.

- 2. **Access Token ë§Œë£Œ ì‹œ ìë™ ê°±ì‹  ì²˜ë¦¬**  
   ì„œë²„ë¡œë¶€í„° `401 Unauthorized` ë˜ëŠ” `403 Forbidden` ì‘ë‹µì´ ëŒì•„ì˜¤ë©´, Access Tokenì´ ë§Œë£Œë˜ì—ˆê±°ë‚˜ ì˜ëª»ë˜ì—ˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.  
   ì´ ê²½ìš° `Refresh Token`ì„ ì´ìš©í•´ ìƒˆë¡œìš´ Access Tokenì„ ë°›ì•„ì˜¤ëŠ” ìš”ì²­ì„ ìë™ìœ¼ë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤.

- 3. **í† í° ê°±ì‹  ì‹¤íŒ¨ ì‹œ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬**  
   Refresh Tokenì´ ë§Œë£Œë˜ì—ˆê±°ë‚˜ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´, ì €ì¥ëœ í† í°ì„ ëª¨ë‘ ì‚­ì œí•˜ê³  ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™ì‹œí‚µë‹ˆë‹¤.  
   ì‚¬ìš©ìëŠ” ìë™ìœ¼ë¡œ ë¡œê·¸ì•„ì›ƒë˜ì–´ ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì•¼ í•©ë‹ˆë‹¤.

ğŸ“Œ **ì •ë¦¬í•˜ë©´**: ì‚¬ìš©ìëŠ” ë¡œê·¸ì¸ ì´í›„ ë³„ë„ì˜ ì¸ì¦ ê³¼ì •ì„ ëŠë¼ì§€ ì•Šê³  ì•±ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°, InterceptorëŠ” ì¸ì¦ì„ ìë™í™”í•˜ì—¬ ì‚¬ìš©ì ê²½í—˜ì„ í–¥ìƒì‹œí‚µë‹ˆë‹¤.

   ```java
   @Override
   public Response intercept(@NonNull Chain chain) throws IOException {
      String accessToken = TokenManager.getAccessToken();
      Request original = chain.request();

      // Access Token í—¤ë”ì— ìë™ ì¶”ê°€
      Request request = original.newBuilder()
         .header("Authorization", "Bearer " + accessToken)
         .build();

      Response response = chain.proceed(request);

      // í† í° ë§Œë£Œ ì‘ë‹µ ì²˜ë¦¬ (401, 403)
      if (response.code() == 401 || response.code() == 403) {
         String refreshToken = TokenManager.getRefreshToken();
         String newAccessToken = TokenManager.refreshAccessToken(refreshToken);

         if (newAccessToken != null) {
            TokenManager.setAccessToken(newAccessToken);
            Request newRequest = original.newBuilder()
               .header("Authorization", "Bearer " + newAccessToken)
               .build();
            return chain.proceed(newRequest);
         } else {
            forceLogout(); // ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
         }
      }

      return response;
   }
   ```

#### ğŸŒ **JwtUtil (Backend)**  
**`JwtUtil`** í´ë˜ìŠ¤ëŠ” ë°±ì—”ë“œ(Spring Boot)ì—ì„œ JWT í† í°ì„ ìƒì„±í•˜ê³  ê²€ì¦í•˜ëŠ” í•µì‹¬ í´ë˜ìŠ¤ì…ë‹ˆë‹¤.

- 1. **Access Token & Refresh Token ìƒì„±**
   - `generateAccessToken(UserResponse userResponse)`  
     ì‚¬ìš©ìì˜ ê¸°ë³¸ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ JWT í† í°ì„ ìƒì„±í•©ë‹ˆë‹¤.  
     ì´ Access Tokenì€ ì¼ë°˜ì ì¸ API ìš”ì²­ì— ì‚¬ìš©ë˜ë©° ë§Œë£Œ ì‹œê°„ì´ ì§§ìŠµë‹ˆë‹¤(ë³´í†µ 1ì‹œê°„).

   - `generateRefreshToken(UserResponse userResponse)`  
     Access Tokenì´ ë§Œë£Œë˜ì—ˆì„ ë•Œ ìƒˆ í† í°ì„ ë°œê¸‰ë°›ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” ì¥ê¸° í† í°ì…ë‹ˆë‹¤(ë³´í†µ 7ì¼).

- 2. **í† í° ì •ë³´ íŒŒì‹± ë° ìœ íš¨ì„± ê²€ì‚¬**
   - `extractClaims(String token)`  
     JWTì— ë‹´ê¸´ í´ë ˆì„(ì´ë©”ì¼, ë‹‰ë„¤ì„ ë“± ì‚¬ìš©ì ì •ë³´)ì„ ì¶”ì¶œí•©ë‹ˆë‹¤.
     
   - `extractEmail(String token)`  
     í† í°ì—ì„œ ì´ë©”ì¼(subject)ì„ ì‰½ê²Œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë„ë¡ ì¶”ì¶œ ë©”ì„œë“œ ì œê³µ.

   - `validateToken(String token)`  
     í† í°ì˜ ë§Œë£Œ ì—¬ë¶€ë¥¼ íŒë‹¨í•˜ì—¬, ì„œë²„ê°€ í•´ë‹¹ í† í°ì„ ë°›ì•„ë“¤ì¼ì§€ ê²°ì •í•©ë‹ˆë‹¤.

ğŸ“Œ **ì •ë¦¬í•˜ë©´**: JwtUtilì€ ì¸ì¦ì— í•„ìš”í•œ í† í° ìƒì„± ë° ê²€ì¦ì„ ë‹´ë‹¹í•˜ë©°, Spring Securityì™€ ì—°ê²°ë˜ì–´ ì‹¤ì§ˆì ì¸ ì¸ì¦ íë¦„ì˜ ì¤‘ì‹¬ì´ ë©ë‹ˆë‹¤.

   ```java
   public String generateAccessToken(UserResponse userResponse) {
      return Jwts.builder()
         .setSubject(userResponse.getEmail()) // ì´ë©”ì¼ì„ subjectë¡œ ì„¤ì •
         .claim("nickname", userResponse.getNickname())
         // ê¸°íƒ€ í´ë ˆì„ ì„¤ì • ...
         .setExpiration(new Date(System.currentTimeMillis() + ACCESS_EXPIRATION_TIME)) // ë§Œë£Œ ì‹œê°„ ì„¤ì •
         .signWith(Keys.hmacShaKeyFor(SECRET_KEY.getBytes()), SignatureAlgorithm.HS256) // ì„œëª… ì•Œê³ ë¦¬ì¦˜ ì„¤ì •
         .compact();
   }

   public String generateRefreshToken(UserResponse userResponse) {
      return Jwts.builder()
         .setSubject(userResponse.getEmail())
         .setExpiration(new Date(System.currentTimeMillis() + REFRESH_EXPIRATION_TIME))
         .signWith(Keys.hmacShaKeyFor(SECRET_KEY.getBytes(StandardCharsets.UTF_8)), SignatureAlgorithm.HS256)
         .compact();
   }

   public Claims extractClaims(String token) {
      return Jwts.parserBuilder()
         .setSigningKey(Keys.hmacShaKeyFor(SECRET_KEY.getBytes(StandardCharsets.UTF_8)))
         .build()
         .parseClaimsJws(token)
         .getBody();
   }

   public String extractEmail(String token) {
      return extractClaims(token).getSubject();
   } 

   public boolean validateToken(String token) {
      return extractClaims(token).getExpiration().after(new Date());
   }
   ```

---

### âœ… êµ¬ê¸€ ë¡œê·¸ì¸

- Androidì—ì„œ êµ¬ê¸€ ê³„ì • ì„ íƒ í›„ `idToken`ì„ íšë“
- í•´ë‹¹ í† í°ì„ ì„œë²„ë¡œ ì „ì†¡
- ì„œë²„ì—ì„œëŠ” êµ¬ê¸€ APIë¡œ `idToken`ì„ ê²€ì¦í•˜ê³ ,
   - ì‹ ê·œ ìœ ì €ì¸ ê²½ìš° íšŒì›ê°€ì… ì²˜ë¦¬
   - ê¸°ì¡´ ìœ ì €ì¸ ê²½ìš° ë¡œê·¸ì¸ ì²˜ë¦¬

   ```java
   @PostMapping("/google/login")
   public ResponseEntity<?> loginForGoogle(@Valid @RequestBody GoogleLoginRequest request, BindingResult result) {
      if (result.hasErrors()) {
         return ResponseEntity.badRequest().body(result.getAllErrors().getFirst().getDefaultMessage());
      }
      
      try {
         JWTClaimsSet claims = tokenVerifier.verify(request.getIdToken());
         
         // claimsì—ì„œ í•„ìš”í•œ ì •ë³´ ì¶”ì¶œ (ì˜ˆ: ì´ë©”ì¼, ì´ë¦„, í”„ë¡œí•„ ì´ë¯¸ì§€ ë“±)
         String email = claims.getStringClaim("email");
         String nickname = claims.getStringClaim("name");
         String imageUrl = claims.getStringClaim("picture");
         
         Map<String, String> tokens = authService.loginForGoogle(email, nickname, imageUrl); // âœ… Access & Refresh Token ë°˜í™˜
         return ResponseEntity.ok(tokens); // âœ… JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µ
      } catch (Exception e) {
         return ResponseEntity.badRequest().body(e.getMessage());
      }
   }
   ```

---

### âœ… í”„ë¡œí•„ ìˆ˜ì •

#### ğŸ“± **Android**
- ì„¤ì • í™”ë©´ì—ì„œ ë‹‰ë„¤ì„, ì´ë¯¸ì§€, ìƒíƒœ ë©”ì‹œì§€ë¥¼ ìˆ˜ì •
- ë³€ê²½ëœ ì •ë³´ë¥¼ `ProfileEditRequest` í˜•íƒœë¡œ ì„œë²„ì— ì „ì†¡  
â†’ ì‘ë‹µìœ¼ë¡œ **ìƒˆë¡œìš´ Access Token**ì„ ë°›ì•„ ì•±ì— ì¦‰ì‹œ ë°˜ì˜

#### ğŸŒ **Backend**

**ì»¨íŠ¸ë¡¤ëŸ¬ ì²˜ë¦¬ íë¦„**

- ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´(@AuthenticationPrincipal)ì—ì„œ ì´ë©”ì¼ì„ ì¶”ì¶œ
- ìœ íš¨ì„± ê²€ì‚¬ í›„ `profileService.update()` í˜¸ì¶œ
- ì‘ë‹µìœ¼ë¡œ ìƒˆë¡œìš´ Access Token ë°˜í™˜

```java
@PatchMapping
public ResponseEntity<?> updateProfile(@Valid @RequestBody ProfileEditRequest request, 
                                       @AuthenticationPrincipal UserPrincipal user) {
   if (user == null) return ResponseEntity.status(HttpStatus.UNAUTHORIZED).body("ìœ íš¨í•˜ì§€ ì•Šì€ ì‚¬ìš©ìì…ë‹ˆë‹¤.");
    
   String email = user.getEmail();
   Map<String, String> token = profileService.update(request, email);
   return ResponseEntity.ok(token);
}
```

**ì„œë¹„ìŠ¤ ì²˜ë¦¬ íë¦„**

- ì´ë©”ì¼ ê¸°ë°˜ìœ¼ë¡œ Account / Profile ì¡°íšŒ
- ë‹‰ë„¤ì„ ì¤‘ë³µ ì—¬ë¶€ í™•ì¸
- í”„ë¡œí•„ ì •ë³´ ìˆ˜ì • ë° ì €ì¥
- ë³€ê²½ëœ ì‚¬ìš©ì ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ **ìƒˆë¡œìš´ Access Token ìƒì„±** í›„ ë°˜í™˜

---

ğŸ“Œ **ì •ë¦¬í•˜ë©´**  
â†’ í”„ë¡œí•„ ìˆ˜ì • ì‹œ ìƒˆë¡œìš´ Access Tokenì„ ì¦‰ì‹œ ë°œê¸‰í•˜ì—¬ ë³€ê²½ì‚¬í•­ì„ ë°˜ì˜  
â†’ ì„œë²„ì—ì„œ ë‹‰ë„¤ì„ ì¤‘ë³µ, ì¸ì¦ ì—¬ë¶€ê¹Œì§€ **ì´ì¤‘ í™•ì¸**í•˜ì—¬ ì•ˆì •ì„±ì„ í™•ë³´í•©ë‹ˆë‹¤.

---

## ğŸ¬ 4. ì‹œì—° ì˜ìƒ

- ì´ˆê¸° ë¡œê·¸ì¸ í™”ë©´ â†’ íšŒì›ê°€ì… í™”ë©´ ì „í™˜
- ì´ë©”ì¼/ë‹‰ë„¤ì„ ì…ë ¥(ìœ íš¨ì„± ê²€ì‚¬) â†’ ê°€ì… ì™„ë£Œ í›„ ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì „í™˜
- ë¡œê·¸ì¸ í›„ ë©”ì¸ í™”ë©´ ì§„ì…
- ì„¤ì • â†’ í”„ë¡œí•„ ìˆ˜ì • ë™ì‘ â†’ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ â†’ ë¡œê·¸ì•„ì›ƒ
- ë°”ë€ ë¹„ë°€ë²ˆí˜¸ë¡œ ì¬ ë¡œê·¸ì¸

<div align="center">
  <a href="https://www.youtube.com/shorts/bZ9ycIyjW48" target="_blank">
    <img src="https://img.youtube.com/vi/bZ9ycIyjW48/0.jpg" alt="Sometodo ì‹œì—° ì˜ìƒ" width="300">
  </a>
  <p>ğŸ¬ <a href="https://www.youtube.com/shorts/bZ9ycIyjW48" target="_blank">ì‹œì—° ì˜ìƒ ë³´ëŸ¬ê°€ê¸°</a></p>
</div>

---

## ğŸ§  5. ì¶”ê°€ ì¤‘ìš” ì½”ë“œ ì„¤ëª…

### ğŸ” TokenManager (Android)

- í† í°ì„ `SharedPreferences`ì— ì €ì¥ ë° ê´€ë¦¬í•©ë‹ˆë‹¤.
- ìë™ ë¡œê·¸ì¸, ë¡œê·¸ì•„ì›ƒ, í† í° ê°±ì‹  ë“±ì„ ì•± ì „ë°˜ì—ì„œ ì²˜ë¦¬í•˜ëŠ” í•µì‹¬ í´ë˜ìŠ¤ì…ë‹ˆë‹¤.
- Interceptorì™€ ì—°ê²°ë˜ì–´ Access Tokenì„ ë¶ˆëŸ¬ì˜¤ê±°ë‚˜ ê°±ì‹ ëœ í† í°ì„ ì €ì¥í•©ë‹ˆë‹¤.

```java
public static void saveTokens(String accessToken, String refreshToken) {
    SharedPreferences.Editor editor = prefs.edit();
    editor.putString("access_token", accessToken);
    editor.putString("refresh_token", refreshToken);
    editor.apply();
}

public static String refreshAccessToken(String refreshToken) {
    try {
        AuthApiService apiService = RetrofitClient.getClient().create(AuthApiService.class);
        Response<RefreshResponse> response = apiService.refresh(new RefreshRequest(refreshToken)).execute();
        if (response.isSuccessful() && response.body() != null) {
            return response.body().getAccessToken();
        }
    } catch (IOException e) {
        Log.e("TokenManager", "Token refresh failed", e);
    }
    return null;
}
```

---

### ğŸ›¡ï¸ JwtAuthenticationFilter (Backend)

- JWT ìœ íš¨ì„±ì„ ê²€ì‚¬í•˜ê³ , ì¸ì¦ëœ ì‚¬ìš©ì ì •ë³´ë¥¼ Spring Security ì¸ì¦ ì»¨í…ìŠ¤íŠ¸ì— ì£¼ì…í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.
- ìœ íš¨í•œ í† í°ì¸ ê²½ìš°, ì‚¬ìš©ì ì •ë³´ë¥¼ `UserPrincipal`ë¡œ ë³€í™˜í•˜ê³  `SecurityContextHolder`ì— ì„¤ì •í•©ë‹ˆë‹¤.

```java
@Override
protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)
        throws ServletException, IOException {
    String token = resolveToken(request);
    if (token != null && jwtUtil.validateToken(token)) {
        String email = jwtUtil.extractEmail(token);
        Claims claims = jwtUtil.extractClaims(token);
        UserResponse userResponse = new UserResponse(email, ...);
        UserPrincipal userPrincipal = new UserPrincipal(userResponse);
        Authentication auth = new UsernamePasswordAuthenticationToken(userPrincipal, token, userPrincipal.getAuthorities());
        SecurityContextHolder.getContext().setAuthentication(auth);
    }
    filterChain.doFilter(request, response);
}
```

---

### ğŸ›¡ï¸ SecurityConfig (Spring Security ë³´ì•ˆ ì„¤ì •)

ì´ í´ë˜ìŠ¤ëŠ” Spring Securityì—ì„œ ì œê³µí•˜ëŠ” ë³´ì•ˆ ì„¤ì •ì„ êµ¬ì„±í•˜ëŠ” ê³³ìœ¼ë¡œ, **JWT ê¸°ë°˜ ì¸ì¦ ì‹œìŠ¤í…œì— ë§ê²Œ ì»¤ìŠ¤í„°ë§ˆì´ì§•**ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

#### ğŸ“Œ ì£¼ìš” ì„¤ëª…

- **@EnableWebSecurity**: Spring Securityë¥¼ í™œì„±í™”ì‹œí‚¤ëŠ” ì–´ë…¸í…Œì´ì…˜ì…ë‹ˆë‹¤.
- **@Configuration**: ì„¤ì • í´ë˜ìŠ¤ë¡œ ë“±ë¡í•©ë‹ˆë‹¤.
- **jwtAuthenticationFilter**: ì‚¬ìš©ìê°€ ë³´ë‚¸ JWTë¥¼ ê²€ì‚¬í•˜ëŠ” í•„í„°ë¡œ, ì¸ì¦ ê³¼ì •ì—ì„œ ê°€ì¥ í•µì‹¬ì ì¸ ì—­í• ì„ í•©ë‹ˆë‹¤.

---

#### ğŸ”‘ í•µì‹¬ ì„¤ì • í•­ëª©

1. **Whitelist (ë¹„ì¸ì¦ ê²½ë¡œ ì„¤ì •)**
   ```java
   private static final String[] WHITELIST = {
       "/api/auth/signup",
       "/api/auth/login",
       "/api/auth/google/login",
       "/api/auth/refresh",
   };
   ```
   - ìœ„ì— ì •ì˜ëœ ê²½ë¡œë“¤ì€ ì¸ì¦ ì—†ì´ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©ë©ë‹ˆë‹¤.
   - íšŒì›ê°€ì…, ë¡œê·¸ì¸, í† í° ê°±ì‹  ë“± ì¸ì¦ ì „ ê³¼ì •ì— í•„ìš”í•œ URLì…ë‹ˆë‹¤.

2. **CSRF ë¹„í™œì„±í™”**
   ```java
   http.csrf(AbstractHttpConfigurer::disable)
   ```
   - JWTëŠ” ì„¸ì…˜ ê¸°ë°˜ì´ ì•„ë‹Œ **ë¬´ìƒíƒœ(stateless)** ì¸ì¦ ë°©ì‹ì´ë¯€ë¡œ CSRF ë³´í˜¸ëŠ” í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

3. **ì„¸ì…˜ ì‚¬ìš© ì•ˆ í•¨**
   ```java
   session.sessionCreationPolicy(SessionCreationPolicy.STATELESS)
   ```
   - ì„œë²„ê°€ ì„¸ì…˜ì„ ìœ ì§€í•˜ì§€ ì•Šë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤. ëª¨ë“  ì¸ì¦ì€ í† í°ì„ ê¸°ë°˜ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤.

4. **ìš”ì²­ ê¶Œí•œ ì„¤ì •**
   ```java
   .authorizeHttpRequests(auth -> auth
       .requestMatchers(WHITELIST).permitAll()
       .anyRequest().authenticated()
   )
   ```
   - í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ì™¸ì˜ ëª¨ë“  ìš”ì²­ì€ ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ì ‘ê·¼ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.

5. **JWT í•„í„° ë“±ë¡**
   ```java
   .addFilterBefore(jwtAuthenticationFilter, UsernamePasswordAuthenticationFilter.class)
   ```
   - ê¸°ë³¸ Username/Password ì¸ì¦ í•„í„° ì „ì— **ì»¤ìŠ¤í…€ JWT í•„í„°**ë¥¼ ì‚½ì…í•˜ì—¬ JWT ì¸ì¦ì„ ë¨¼ì € ì²˜ë¦¬í•©ë‹ˆë‹¤.

---

### âœ… ìš”ì•½ ì •ë¦¬

- `SecurityConfig`ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ **ì „ì²´ ë³´ì•ˆ íë¦„ì„ ì œì–´**í•˜ëŠ” ì„¤ì • í´ë˜ìŠ¤ì…ë‹ˆë‹¤.
- í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ê²½ë¡œë§Œ ì¸ì¦ ì—†ì´ ì ‘ê·¼ ê°€ëŠ¥í•˜ë©°, ê·¸ ì™¸ ëª¨ë“  APIëŠ” JWT í† í°ì´ ìˆì–´ì•¼ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.
- ì„¸ì…˜ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  í† í° ê¸°ë°˜ìœ¼ë¡œ ì¸ì¦ì´ ì´ë£¨ì–´ì§€ë©°, ì»¤ìŠ¤í…€ JWT ì¸ì¦ í•„í„°(`JwtAuthenticationFilter`)ë¥¼ í†µí•´ í† í°ì„ ê²€ì¦í•©ë‹ˆë‹¤.

---
