# Some To Do - ì¼ì •, ê°€ê³„ë¶€ ê´€ë¦¬ ì•±

## ğŸ’¡ 1. í”„ë¡œì íŠ¸ ê°œìš”

### ğŸ“Œ í”„ë¡œì íŠ¸ëª…  
**SomeToDo** â€“ ì¼ì • ë° ê°€ê³„ë¶€ ê´€ë¦¬ í†µí•© ì•±

### ğŸ¯ ëª©ì   
í•˜ë£¨ì˜ ìŠ¤ì¼€ì¤„ê³¼ ì§€ì¶œ ë‚´ì—­ì„ í•œ ê³³ì—ì„œ ê´€ë¦¬í•  ìˆ˜ ìˆë„ë¡ ë•ëŠ” í†µí•©í˜• ëª¨ë°”ì¼ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œ  
â†’ ì‚¬ìš©ì ì¤‘ì‹¬ì˜ **ê°„í¸í•œ UI/UX**, **ê³„ì • ì¸ì¦ ë° ë³´ì•ˆ**, **ë°ì´í„° ì €ì¥ ë° ì—°ë™**ì— ì¤‘ì ì„ ë‘ì–´ ì„¤ê³„

### ğŸ•’ ê°œë°œ ê¸°ê°„  
**2024. 02. 25 ~ 2024. 03. 28 (ì•½ 5ì£¼)**

| ì£¼ì°¨       | ì£¼ìš” ë‚´ìš© |
|------------|-----------|
| **1ì£¼ì°¨** | ì£¼ì œ ì„ ì • ë° ìš”êµ¬ì‚¬í•­ ë¶„ì„, ì£¼ìš” ê¸°ëŠ¥ ê¸°íš ë° ê¸°ìˆ  ìŠ¤íƒ ê²°ì • |
| **2~3ì£¼ì°¨** | ê°œì¸ë³„ íŒŒíŠ¸ ë¶„ë‹´ ë° ê¸°ëŠ¥ë³„ ì„¤ê³„, í™”ë©´ UI ì´ˆì•ˆ ì œì‘, ê¸°ëŠ¥ ë‹¨ìœ„ ê°œë°œ ì§„í–‰ |
| **4ì£¼ì°¨** | ì½”ë“œ í†µí•© ë° í™”ë©´ ì—°ë™, API ì—°ê²° í…ŒìŠ¤íŠ¸, ì˜ˆì™¸ ì²˜ë¦¬ ë° ì˜¤ë¥˜ ìˆ˜ì • |
| **5ì£¼ì°¨** | ë””ë²„ê¹… ë° ì„±ëŠ¥ ê°œì„ , AWS EC2ë¥¼ í†µí•œ ë°°í¬, í”„ë¡œì íŠ¸ ë¬¸ì„œ ì •ë¦¬ ë° ë°œí‘œ ì¤€ë¹„ |

### ğŸ§‘â€ğŸ’» íŒ€ êµ¬ì„± (ì´ 3ì¸)
| ì´ë¦„       | ì—­í•                | ì£¼ìš” ë‹´ë‹¹ ê¸°ëŠ¥ |
|------------|--------------------|----------------|
| ì—„ì •í˜„ (ë³¸ì¸) | **ê³„ì • íŒŒíŠ¸ ê°œë°œ**     | íšŒì›ê°€ì…, ë¡œê·¸ì¸, JWT ì¸ì¦, êµ¬ê¸€ ë¡œê·¸ì¸, í”„ë¡œí•„ ê´€ë¦¬ |
| [ë°±ê±´ìš°](https://github.com/gunwoo100/project_schedule)     | ì¼ì • ê¸°ëŠ¥ ê°œë°œ         | ì¼ì • ë“±ë¡, ì¡°íšŒ, ìˆ˜ì •, ì‚­ì œ ë° UI êµ¬ì„± |
| [ê¹€ì§€ìš±](https://github.com/orangetunnelkim/moneyFlow)     | ê°€ê³„ë¶€ ê¸°ëŠ¥ ê°œë°œ      | ì§€ì¶œ ë“±ë¡, í†µê³„ í™”ë©´, ê°€ê³„ë¶€ UI ë° ë°±ì—”ë“œ ë¡œì§ |

### ğŸ›  ê¸°ìˆ  ìŠ¤íƒ
- **Frontend**: Android (Java), Retrofit2, Glide, SharedPreferences  
- **Backend**: Spring Boot, Spring Security, JPA, PostgreSQL, JWT

---

## âœ… 2. í•µì‹¬ ê¸°ëŠ¥ ìš”ì•½

ì´ í”„ë¡œì íŠ¸ì˜ ê³„ì • íŒŒíŠ¸ëŠ” ì‚¬ìš©ì ì¸ì¦ ë° ì •ë³´ ê´€ë¦¬ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì€ í•µì‹¬ ê¸°ëŠ¥ì„ í¬í•¨í•©ë‹ˆë‹¤. ê° ê¸°ëŠ¥ì€ ì´ë¯¸ì§€ ë˜ëŠ” gifì™€ í•¨ê»˜ ì§ê´€ì ìœ¼ë¡œ ì´í•´í•  ìˆ˜ ìˆë„ë¡ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

---

### 1ï¸âƒ£ ë¡œê·¸ì¸ í™”ë©´ (ğŸ“± Android í™”ë©´)

- **ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ë˜ëŠ” êµ¬ê¸€ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ ê°€ëŠ¥**
- **ì…ë ¥ê°’ ìœ íš¨ì„± ê²€ì‚¬ ë° ë¡œê·¸ì¸ ì‹¤íŒ¨ ì•ˆë‚´ ì²˜ë¦¬**
- ë¡œê·¸ì¸ ì„±ê³µ ì‹œ, ìë™ìœ¼ë¡œ JWT í† í° ì €ì¥

<div align="center">
  <img src="https://github.com/user-attachments/assets/becbf6b5-96e0-4f6c-8c58-77011824a966" alt="ë¡œê·¸ì¸ í™”ë©´" width="300">
</div>

---

### 2ï¸âƒ£ íšŒì›ê°€ì… í™”ë©´

- **ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸, ë‹‰ë„¤ì„ ì…ë ¥ë§Œìœ¼ë¡œ ê°„í¸ ê°€ì…**
- **ì…ë ¥ê°’ ìœ íš¨ì„± + ì´ë©”ì¼/ë‹‰ë„¤ì„ ì¤‘ë³µ ê²€ì‚¬ í¬í•¨**
- íšŒì›ê°€ì… ì„±ê³µ ì‹œ ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™

<div align="center">
  <img src="https://github.com/user-attachments/assets/cb9fcce7-2b97-4190-923e-14f2404e2bf8" alt="íšŒì›ê°€ì… í™”ë©´" width="300">
</div>

---

### 3ï¸âƒ£ ì„¤ì • í˜ì´ì§€

- **í”„ë¡œí•„ ë³´ê¸°, ìˆ˜ì •, ë¹„ë°€ë²ˆí˜¸ ë³€ê²½, ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥ ì œê³µ**
- í•˜ë‹¨ ë©”ë‰´ì˜ â€˜ì„¤ì •â€™ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥

<div align="center">
  <img src="https://github.com/user-attachments/assets/39edc96b-8091-4f33-beb9-83153d404007" alt="ì„¤ì • í™”ë©´" width="300">
</div>

---

### 4ï¸âƒ£ í”„ë¡œí•„ ìˆ˜ì • í™”ë©´

- **ë‹‰ë„¤ì„, ìƒíƒœ ë©”ì‹œì§€, í”„ë¡œí•„ ì´ë¯¸ì§€ ìˆ˜ì • ê°€ëŠ¥**
- ìˆ˜ì • í›„ì—ëŠ” ë³€ê²½ëœ ë‚´ìš©ì„ ë°˜ì˜í•œ ìƒˆë¡œìš´ Access Token ë°œê¸‰

<div align="center">
  <img src="https://github.com/user-attachments/assets/dd0f74f2-0485-4991-a069-b88364005d1d" alt="í”„ë¡œí•„ ìˆ˜ì • í™”ë©´" width="300">
</div>

---

### 5ï¸âƒ£ êµ¬ê¸€ ë¡œê·¸ì¸ (ì†Œì…œ ë¡œê·¸ì¸)

- **Firebase ì—†ì´ Google OAuth2.0ìœ¼ë¡œ êµ¬í˜„**
- **idTokenì„ ë°›ì•„ ë°±ì—”ë“œì—ì„œ ê²€ì¦ ë° ìë™ íšŒì›ê°€ì… ì²˜ë¦¬**
- ì´ë©”ì¼ ì¤‘ë³µ ì‹œ ê¸°ì¡´ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ ì‹¤íŒ¨ ì²˜

<div align="center">
  <img src="https://github.com/user-attachments/assets/495fe2e1-975a-444d-b1d3-395e91333d2d" alt="êµ¬ê¸€ ë¡œê·¸ì¸ í™”ë©´" width="300">
</div>
![image](https://github.com/user-attachments/assets/df971de6-a757-46ae-b2c9-a5af3b654c49)

---

### ğŸ” ì°¸ê³ 

- ì´ ì„¹ì…˜ì€ **ì£¼ìš” ê¸°ëŠ¥ì˜ êµ¬ì¡°ì™€ íë¦„ì„ ì‹œê°ì ìœ¼ë¡œ ë³´ì—¬ì£¼ëŠ” ì—­í• **ì„ í•©ë‹ˆë‹¤.
- ì‹¤ì œ ë™ì‘ ì¥ë©´ì„ ìì„¸íˆ ë³´ê³  ì‹¶ë‹¤ë©´ ì•„ë˜ì˜ **4. ì‹œì—° ì˜ìƒ** ì„¹ì…˜ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## 3. ê¸°ëŠ¥ êµ¬í˜„

ê³„ì • íŒŒíŠ¸ì—ì„œ êµ¬í˜„í•œ ì£¼ìš” ê¸°ëŠ¥ë“¤ì„ ì‹¤ì œ íë¦„ì— ë§ì¶° ì„¤ëª…í•˜ê³ , ê° ê¸°ëŠ¥ì˜ êµ¬í˜„ ë°©ì‹ì„ ê°„ë‹¨íˆ ì†Œê°œí•©ë‹ˆë‹¤.

---

### âœ… íšŒì›ê°€ì…

- **Android**
   - ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸, ë‹‰ë„¤ì„ì„ ì…ë ¥ë°›ê³  **ìœ íš¨ì„± ê²€ì‚¬**ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.
   - ì…ë ¥ê°’ í™•ì¸ í›„ `SignupRequest` DTOë¥¼ ìƒì„±í•˜ì—¬ ì„œë²„ì— ì „ì†¡í•©ë‹ˆë‹¤.  
   - ì„œë²„ ì‘ë‹µì— ë”°ë¼ ì„±ê³µ ë©”ì‹œì§€ë¥¼ ì¶œë ¥í•˜ê±°ë‚˜ ì‹¤íŒ¨ ì•Œë¦¼ì„ ë„ì›ë‹ˆë‹¤.
  
   ```java
   public void onSignupButtonClick(View view) {
        String email = etEmail.getText().toString().trim();
        String password = etPassword.getText().toString().trim();
        String passwordCheck = etPasswordCheck.getText().toString().trim();
        String nickname = etNickname.getText().toString().trim();

        // 1ï¸âƒ£ ì…ë ¥ê°’ ê²€ì¦
        if (email.isEmpty() || password.isEmpty() || passwordCheck.isEmpty() || nickname.isEmpty()) {
            Toast.makeText(this, "ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.", Toast.LENGTH_SHORT).show();
            return;
        }

        if (!Patterns.EMAIL_ADDRESS.matcher(email).matches()) {
            Toast.makeText(this, "ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì„ ì…ë ¥í•˜ì„¸ìš”.", Toast.LENGTH_SHORT).show();
            return;
        }

        if (!password.equals(passwordCheck)) {
            Toast.makeText(this, "ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.", Toast.LENGTH_SHORT).show();
            return;
        }

        if (password.length() < 8 || password.length() > 20) {
            Toast.makeText(this, "ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒ 20ì ì´í•˜ì´ì–´ì•¼ í•©ë‹ˆë‹¤.", Toast.LENGTH_SHORT).show();
            return;
        }

        if (!nickname.matches("^[a-zA-Z0-9ê°€-í£]+$")) {
            Toast.makeText(this, "ë‹‰ë„¤ì„ì€ ì˜ë¬¸, ìˆ«ì, í•œê¸€ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.", Toast.LENGTH_SHORT).show();
            return;
        }

        if (nickname.length() < 2 || nickname.length() > 12) {
            Toast.makeText(this, "ë‹‰ë„¤ì„ì€ 2ì ì´ìƒ 12ì ì´í•˜ì´ì–´ì•¼ í•©ë‹ˆë‹¤.", Toast.LENGTH_SHORT).show();
            return;
        }

        // 2ï¸âƒ£ API ìš”ì²­ì„ ìœ„í•œ SignupRequest ê°ì²´ ìƒì„±
        SignupRequest signupRequest = new SignupRequest(email, password, passwordCheck, nickname);

        // 3ï¸âƒ£ Retrofitì„ í†µí•´ íšŒì›ê°€ì… ìš”ì²­
        AuthApiService authApiService = RetrofitClient.getClient().create(AuthApiService.class);
        Call<Void> call = authApiService.signup(signupRequest);

        call.enqueue(new Callback<Void>() {
            @Override
            public void onResponse(@NonNull Call<Void> call, @NonNull Response<Void> response) {
                if (response.isSuccessful()) {
                    Toast.makeText(SignupActivity.this, "íšŒì›ê°€ì… ì„±ê³µ!", Toast.LENGTH_SHORT).show();

                    // 4ï¸âƒ£ ì„±ê³µ ì‹œ ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™
                    finish();
                } else {
                    Toast.makeText(SignupActivity.this, "íšŒì›ê°€ì… ì‹¤íŒ¨: " + response.message(), Toast.LENGTH_SHORT).show();
                }
            }

            @Override
            public void onFailure(@NonNull Call<Void> call, @NonNull Throwable t) {
                Toast.makeText(SignupActivity.this, "ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë°œìƒ", Toast.LENGTH_SHORT).show();
            }
        });
    }   
   ```

- **Backend**
   - ì´ë©”ì¼ ë° ë‹‰ë„¤ì„ **ì¤‘ë³µ ê²€ì‚¬**
   - ë¹„ë°€ë²ˆí˜¸ **BCrypt ì•”í˜¸í™”** í›„ ì €ì¥
   - `Account` / `Profile` í…Œì´ë¸”ì— ë¶„ë¦¬ ì €ì¥
  
   ```java
   public void registerAccount(@Valid SignupRequest request) {
      // ì´ë©”ì¼ ì¤‘ë³µ ì²´í¬
      if (accountRepository.existsByEmail(request.getEmail()))
         throw new IllegalArgumentException("ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤.");
      // ë‹‰ë„¤ì„ ì¤‘ë³µ ì²´í¬
      if (profileRepository.existsByNickname(request.getNickname()))
         throw new IllegalArgumentException("ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.");

      Account account = Account.builder()
            .email(request.getEmail())
            .password(passwordEncoder.encode(request.getPassword())) // ì•”í˜¸í™”ëœ ë¹„ë°€ë²ˆí˜¸ ì €ì¥
            .authProvider(AuthProvider.EMAIL)
            .role(UserRole.USER)
            .status(UserStatus.ACTIVE)
            .createdAt(LocalDateTime.now())
            .updatedAt(LocalDateTime.now())
            .build();

      accountRepository.save(account);

      Profile profile = Profile.builder()
            .account(account)
            .nickname(request.getNickname())
            .updatedAt(LocalDateTime.now())
            .build();

      profileRepository.save(profile);
   }
   ```

---

### âœ… ë¡œê·¸ì¸

- **Android**
   - ì‚¬ìš©ìê°€ ì…ë ¥í•œ ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¡œ ì„œë²„ì— ìš”ì²­
   - ë¡œê·¸ì¸ ì„±ê³µ ì‹œ **Access Token**ê³¼ **Refresh Token**ì„ ë°œê¸‰ë°›ì•„ `TokenManager`ì— ì €ì¥

   ```java
   public void onLoginButtonClick(View view) {
      String email = etEmail.getText().toString().trim();
      String password = etPassword.getText().toString().trim();

      if (email.isEmpty() || password.isEmpty()) {
         Toast.makeText(this, "ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.", Toast.LENGTH_SHORT).show();
         return;
      }

      if (!Patterns.EMAIL_ADDRESS.matcher(email).matches()) {
         Toast.makeText(this, "ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì„ ì…ë ¥í•˜ì„¸ìš”.", Toast.LENGTH_SHORT).show();
         return;
      }

      AuthApiService apiService = RetrofitClient.getClient().create(AuthApiService.class);
      Call<LoginResponse> call = apiService.login(new LoginRequest(email, password));
      
      call.enqueue(new Callback<LoginResponse>() {
         @Override
         public void onResponse(@NonNull Call<LoginResponse> call, @NonNull Response<LoginResponse> response) {
            if (response.isSuccessful() && response.body() != null) {
               loginSuccess(response.body());
            } else {
               try (ResponseBody errorBody = response.errorBody()) {  // âœ… try-with-resources ì‚¬ìš©
                  if (errorBody != null) {
                     Toast.makeText(LoginActivity.this, "ë¡œê·¸ì¸ ì‹¤íŒ¨: " + errorBody.string(), Toast.LENGTH_SHORT).show();
                  } else {
                     Toast.makeText(LoginActivity.this, "ë¡œê·¸ì¸ ì‹¤íŒ¨: ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜", Toast.LENGTH_SHORT).show();
                  }
               } catch (Exception e) {
                  Toast.makeText(LoginActivity.this, "ë¡œê·¸ì¸ ì‹¤íŒ¨: ì‘ë‹µ ì²˜ë¦¬ ì˜¤ë¥˜", Toast.LENGTH_SHORT).show();
               }
            }
         }
         
         @Override
         public void onFailure(@NonNull Call<LoginResponse> call, @NonNull Throwable t) {
            Toast.makeText(LoginActivity.this, "ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë°œìƒ", Toast.LENGTH_SHORT).show();
         }
      });
   }
   ```

- **Backend**
   - ì´ë©”ì¼ ì¡´ì¬ ì—¬ë¶€ í™•ì¸ í›„, ë¹„ë°€ë²ˆí˜¸ ê²€ì¦
   - ê²€ì¦ ì„±ê³µ ì‹œ JWT í† í° ìƒì„± ë° ì‘ë‹µ
  
   ```java
   public Map<String, String>  login(@Valid LoginRequest request) {
      // ì´ë©”ì¼ë¡œ ì‚¬ìš©ì ì¡°íšŒ
      Account account = accountRepository.findByEmail(request.getEmail())
         .orElseThrow(() -> new IllegalArgumentException("ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤."));
      
      // ë¹„ë°€ë²ˆí˜¸ ê²€ì¦
      if (!passwordEncoder.matches(request.getPassword(), account.getPassword())) {
         throw new IllegalArgumentException("ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.");
      }
      
      return getTokens(account);
   }
   ```

   ```java
   private Map<String, String> getTokens(Account account) {
      // í”„ë¡œí•„ ì •ë³´ ì¡°íšŒ
      Profile profile = profileRepository.findByAccount(account)
         .orElseThrow(() -> new IllegalArgumentException("í”„ë¡œí•„ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."));
      
      // ì‚¬ìš©ì ì •ë³´
      UserResponse userResponse = UserResponse.builder()
         .email(account.getEmail())
         .nickname(profile.getNickname())
         .imageUrl(profile.getImageUrl())
         .statusMessage(profile.getStatusMessage())
         .role(account.getRole())
         .build();
      
      String accessToken = jwtUtil.generateAccessToken(userResponse);
      String refreshToken = jwtUtil.generateRefreshToken(userResponse);
      
      Optional<RefreshToken> existingToken = refreshTokenRepository.findByAccount(account);
      
      if (existingToken.isPresent()) {
         // ê¸°ì¡´ Refresh Token ì—…ë°ì´íŠ¸
         RefreshToken refreshTokenEntity = existingToken.get();
         refreshTokenEntity.setToken(refreshToken);
         refreshTokenEntity.setExpirationDate(LocalDateTime.now().plusDays(7));
         refreshTokenRepository.save(refreshTokenEntity);
      } else {
         refreshTokenRepository.save(
            RefreshToken.builder()
            .token(refreshToken)
            .account(account)
            .expirationDate(LocalDateTime.now().plusDays(7))
            .build()
         );
      }
      
      account.setLastLoginAt(LocalDateTime.now());
      accountRepository.save(account);
      
      Map<String, String> tokens = new HashMap<>();
      tokens.put("accessToken", accessToken);
      tokens.put("refreshToken", refreshToken);
      
      return tokens;
   }
   ```

---

### âœ… JWT í† í° ê´€ë¦¬

> JWT ê¸°ë°˜ ì¸ì¦ ì‹œìŠ¤í…œì€ **í† í°ì„ ì´ìš©í•œ ë¬´ìƒíƒœ(stateless) ì¸ì¦ ë°©ì‹**ì…ë‹ˆë‹¤. ì´ í”„ë¡œì íŠ¸ì—ì„œëŠ” Androidì—ì„œëŠ” Interceptorë¡œ, Spring Bootì—ì„œëŠ” JwtUtil í´ë˜ìŠ¤ë¥¼ í†µí•´ ê°ê° í† í°ì„ ì£¼ê³ ë°›ê³  ê´€ë¦¬í•˜ëŠ” êµ¬ì¡°ë¥¼ ê°–ìŠµë‹ˆë‹¤

---

#### ğŸ“± **Interceptor (Android)**  
**`AuthInterceptor`** í´ë˜ìŠ¤ëŠ” ëª¨ë“  HTTP ìš”ì²­ì— ëŒ€í•´ ë‹¤ìŒê³¼ ê°™ì€ ì—­í• ì„ í•©ë‹ˆë‹¤:

- 1. **Authorization í—¤ë” ìë™ ì¶”ê°€**  
   ì‚¬ìš©ìê°€ ë¡œê·¸ì¸í•  ë•Œ ë°œê¸‰ë°›ì€ Access Tokenì„ SharedPreferencesì—ì„œ êº¼ë‚´ì™€, ë§¤ ìš”ì²­ë§ˆë‹¤ `Authorization: Bearer <Access Token>` í˜•ì‹ìœ¼ë¡œ ìš”ì²­ í—¤ë”ì— ìë™ìœ¼ë¡œ ì¶”ê°€í•©ë‹ˆë‹¤. ì´ë¡œì¨ API ìš”ì²­ë§ˆë‹¤ í† í°ì„ ìˆ˜ë™ìœ¼ë¡œ ë¶™ì´ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤.

- 2. **Access Token ë§Œë£Œ ì‹œ ìë™ ê°±ì‹  ì²˜ë¦¬**  
   ì„œë²„ë¡œë¶€í„° `401 Unauthorized` ë˜ëŠ” `403 Forbidden` ì‘ë‹µì´ ëŒì•„ì˜¤ë©´, Access Tokenì´ ë§Œë£Œë˜ì—ˆê±°ë‚˜ ì˜ëª»ë˜ì—ˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.  
   ì´ ê²½ìš° `Refresh Token`ì„ ì´ìš©í•´ ìƒˆë¡œìš´ Access Tokenì„ ë°›ì•„ì˜¤ëŠ” ìš”ì²­ì„ ìë™ìœ¼ë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤.

- 3. **í† í° ê°±ì‹  ì‹¤íŒ¨ ì‹œ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬**  
   Refresh Tokenì´ ë§Œë£Œë˜ì—ˆê±°ë‚˜ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´, ì €ì¥ëœ í† í°ì„ ëª¨ë‘ ì‚­ì œí•˜ê³  ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™ì‹œí‚µë‹ˆë‹¤.  
   ì‚¬ìš©ìëŠ” ìë™ìœ¼ë¡œ ë¡œê·¸ì•„ì›ƒë˜ì–´ ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì•¼ í•©ë‹ˆë‹¤.

ğŸ“Œ **ì •ë¦¬í•˜ë©´**: ì‚¬ìš©ìëŠ” ë¡œê·¸ì¸ ì´í›„ ë³„ë„ì˜ ì¸ì¦ ê³¼ì •ì„ ëŠë¼ì§€ ì•Šê³  ì•±ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°, InterceptorëŠ” ì¸ì¦ì„ ìë™í™”í•˜ì—¬ ì‚¬ìš©ì ê²½í—˜ì„ í–¥ìƒì‹œí‚µë‹ˆë‹¤.


   ```java
   public class AuthInterceptor implements Interceptor {
      private final Context context;

      public AuthInterceptor(Context context) {
         this.context = context.getApplicationContext(); // ApplicationContext ì‚¬ìš©
      } 
      
      @NonNull
      @Override
      public Response intercept(@NonNull Chain chain) throws IOException {
         String accessToken = TokenManager.getAccessToken();
         Request original = chain.request();
         
         // refresh ì—”ë“œí¬ì¸íŠ¸ëŠ” í† í° ê²€ì¦ ê±´ë„ˆë›°ê¸°
         if (original.url().encodedPath().contains("/api/auth/refresh")) {
            return chain.proceed(original);
         }   
         
         Request request = original.newBuilder()
            .header("Authorization", "Bearer " + accessToken)
            .build();

         Response response = chain.proceed(request);

         // 401 Unauthorized â†’ Access Tokenì´ ë§Œë£Œë˜ì—ˆì„ ê°€ëŠ¥ì„±ì´ ìˆìŒ
         if (response.code() == 401 || response.code() == 403) {
            synchronized (this) {
               String refreshToken = TokenManager.getRefreshToken();
               if (refreshToken != null) {
                  String newAccessToken = TokenManager.refreshAccessToken(refreshToken);
                  if (newAccessToken != null) {
                     TokenManager.setAccessToken(newAccessToken);
                     
                     // ìƒˆë¡œìš´ Access Tokenìœ¼ë¡œ ë‹¤ì‹œ ìš”ì²­ ì‹¤í–‰
                     Request newRequest = original.newBuilder()
                        .header("Authorization", "Bearer " + newAccessToken)
                        .build();
                     return chain.proceed(newRequest);
                  } else {
                     // í† í° ê°±ì‹  ì‹¤íŒ¨: ê°•ì œ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
                     forceLogout();
                  }
               } else {
                  // Refresh Tokenì´ ì—†ìœ¼ë©´ ê°•ì œ ë¡œê·¸ì•„ì›ƒ
                  forceLogout();
               }
            }
         }   
         
         return response;
         }

      /**
      * ê°•ì œë¡œ ë¡œê·¸ì•„ì›ƒ ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œì¼œ ì•± ì „ì²´ë¥¼ ë¡œê·¸ì•„ì›ƒ ìƒíƒœë¡œ ë§Œë“­ë‹ˆë‹¤.
      */
      private void forceLogout() {
         // í† í° ì‚­ì œ
         TokenManager.clearTokens();

         // UI ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰
         new Handler(Looper.getMainLooper()).post(() -> {
            Intent intent = new Intent(context, LoginActivity.class);
            // ê¸°ì¡´ì˜ ëª¨ë“  ì•¡í‹°ë¹„í‹°ë¥¼ ì œê±°í•˜ê³  ìƒˆë¡œìš´ íƒœìŠ¤í¬ì—ì„œ LoginActivity ì‹¤í–‰
            intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);
            context.startActivity(intent);
         });
      }
   }
   ```

#### ğŸŒ **JwtUtil (Backend)**  
**`JwtUtil`** í´ë˜ìŠ¤ëŠ” ë°±ì—”ë“œ(Spring Boot)ì—ì„œ JWT í† í°ì„ ìƒì„±í•˜ê³  ê²€ì¦í•˜ëŠ” í•µì‹¬ í´ë˜ìŠ¤ì…ë‹ˆë‹¤.

- 1. **Access Token & Refresh Token ìƒì„±**
   - `generateAccessToken(UserResponse userResponse)`  
     ì‚¬ìš©ìì˜ ê¸°ë³¸ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ JWT í† í°ì„ ìƒì„±í•©ë‹ˆë‹¤.  
     ì´ Access Tokenì€ ì¼ë°˜ì ì¸ API ìš”ì²­ì— ì‚¬ìš©ë˜ë©° ë§Œë£Œ ì‹œê°„ì´ ì§§ìŠµë‹ˆë‹¤(ë³´í†µ 1ì‹œê°„).

   - `generateRefreshToken(UserResponse userResponse)`  
     Access Tokenì´ ë§Œë£Œë˜ì—ˆì„ ë•Œ ìƒˆ í† í°ì„ ë°œê¸‰ë°›ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” ì¥ê¸° í† í°ì…ë‹ˆë‹¤(ë³´í†µ 7ì¼).

- 2. **í† í° ì •ë³´ íŒŒì‹± ë° ìœ íš¨ì„± ê²€ì‚¬**
   - `extractClaims(String token)`  
     JWTì— ë‹´ê¸´ í´ë ˆì„(ì´ë©”ì¼, ë‹‰ë„¤ì„ ë“± ì‚¬ìš©ì ì •ë³´)ì„ ì¶”ì¶œí•©ë‹ˆë‹¤.
     
   - `extractEmail(String token)`  
     í† í°ì—ì„œ ì´ë©”ì¼(subject)ì„ ì‰½ê²Œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë„ë¡ ì¶”ì¶œ ë©”ì„œë“œ ì œê³µ.

   - `validateToken(String token)`  
     í† í°ì˜ ë§Œë£Œ ì—¬ë¶€ë¥¼ íŒë‹¨í•˜ì—¬, ì„œë²„ê°€ í•´ë‹¹ í† í°ì„ ë°›ì•„ë“¤ì¼ì§€ ê²°ì •í•©ë‹ˆë‹¤.

ğŸ“Œ **ì •ë¦¬í•˜ë©´**: JwtUtilì€ ì¸ì¦ì— í•„ìš”í•œ í† í° ìƒì„± ë° ê²€ì¦ì„ ë‹´ë‹¹í•˜ë©°, Spring Securityì™€ ì—°ê²°ë˜ì–´ ì‹¤ì§ˆì ì¸ ì¸ì¦ íë¦„ì˜ ì¤‘ì‹¬ì´ ë©ë‹ˆë‹¤.


   ```java
   @Component
   public class JwtUtil {
      private static final String SECRET_KEY = "F2...";
      private static final long ACCESS_EXPIRATION_TIME = 1000 * 10 * 60 * 60; // 1ì‹œê°„
      private static final long REFRESH_EXPIRATION_TIME = 1000 * 60 * 60 * 24 * 7; // 7ì¼

      public String generateAccessToken(UserResponse userResponse) {
         return Jwts.builder()
            .setSubject(userResponse.getEmail()) // ì´ë©”ì¼ì„ subjectë¡œ ì„¤ì •
            .claim("nickname", userResponse.getNickname())
            .claim("imageUrl", userResponse.getImageUrl())
            .claim("statusMessage", userResponse.getStatusMessage())
            .claim("role", userResponse.getRole().toString())
            .setExpiration(new Date(System.currentTimeMillis() + ACCESS_EXPIRATION_TIME)) // ë§Œë£Œ ì‹œê°„ ì„¤ì •
            .signWith(Keys.hmacShaKeyFor(SECRET_KEY.getBytes()), SignatureAlgorithm.HS256) // ì„œëª… ì•Œê³ ë¦¬ì¦˜ ì„¤ì •
            .compact();
      }

      public String generateRefreshToken(UserResponse userResponse) {
         return Jwts.builder()
            .setSubject(userResponse.getEmail())
            .setExpiration(new Date(System.currentTimeMillis() + REFRESH_EXPIRATION_TIME))
            .signWith(Keys.hmacShaKeyFor(SECRET_KEY.getBytes(StandardCharsets.UTF_8)), SignatureAlgorithm.HS256)
            .compact();
      }

      public Claims extractClaims(String token) {
         return Jwts.parserBuilder()
            .setSigningKey(Keys.hmacShaKeyFor(SECRET_KEY.getBytes(StandardCharsets.UTF_8)))
            .build()
            .parseClaimsJws(token)
            .getBody();
      }

      public String extractEmail(String token) {
         return extractClaims(token).getSubject();
      } 

      public boolean validateToken(String token) {
         return extractClaims(token).getExpiration().after(new Date());
      }
   }
   ```

---

### âœ… êµ¬ê¸€ ë¡œê·¸ì¸

- Androidì—ì„œ êµ¬ê¸€ ê³„ì • ì„ íƒ í›„ `idToken`ì„ íšë“
- í•´ë‹¹ í† í°ì„ ì„œë²„ë¡œ ì „ì†¡
- ì„œë²„ì—ì„œëŠ” êµ¬ê¸€ APIë¡œ `idToken`ì„ ê²€ì¦í•˜ê³ ,
   - ì‹ ê·œ ìœ ì €ì¸ ê²½ìš° íšŒì›ê°€ì… ì²˜ë¦¬
   - ê¸°ì¡´ ìœ ì €ì¸ ê²½ìš° ë¡œê·¸ì¸ ì²˜ë¦¬

   ```java
   @PostMapping("/google/login")
   public ResponseEntity<?> loginForGoogle(@Valid @RequestBody GoogleLoginRequest request, BindingResult result) {
      if (result.hasErrors()) {
         return ResponseEntity.badRequest().body(result.getAllErrors().getFirst().getDefaultMessage());
      }
      
      try {
         JWTClaimsSet claims = tokenVerifier.verify(request.getIdToken());
         
         // claimsì—ì„œ í•„ìš”í•œ ì •ë³´ ì¶”ì¶œ (ì˜ˆ: ì´ë©”ì¼, ì´ë¦„, í”„ë¡œí•„ ì´ë¯¸ì§€ ë“±)
         String email = claims.getStringClaim("email");
         String nickname = claims.getStringClaim("name");
         String imageUrl = claims.getStringClaim("picture");
         
         Map<String, String> tokens = authService.loginForGoogle(email, nickname, imageUrl); // âœ… Access & Refresh Token ë°˜í™˜
         return ResponseEntity.ok(tokens); // âœ… JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µ
      } catch (Exception e) {
         return ResponseEntity.badRequest().body(e.getMessage());
      }
   }
   ```

---

### âœ… í”„ë¡œí•„ ìˆ˜ì •

- **Android**
   - ì„¤ì • í™”ë©´ì—ì„œ ë‹‰ë„¤ì„, ì´ë¯¸ì§€, ìƒíƒœ ë©”ì‹œì§€ ìˆ˜ì •
   - ë³€ê²½ëœ ê°’ì„ ì„œë²„ì— ìš”ì²­ 

- **Backend**
   - ì¸ì¦ëœ ì‚¬ìš©ìì˜ ì´ë©”ì¼ë¡œ `Account`ì™€ `Profile` ì¡°íšŒ
   - ìˆ˜ì •ëœ ê°’ ì €ì¥ í›„ ìƒˆë¡œìš´ Access Token ë°˜í™˜ (ì¦‰ì‹œ ë°˜ì˜ ëª©ì )

   ```java
   @PatchMapping
   public ResponseEntity<?> updateProfile(@Valid @RequestBody ProfileEditRequest request, BindingResult result,
                                          @AuthenticationPrincipal UserPrincipal userPrincipal) {  // âœ… í˜„ì¬ ë¡œê·¸ì¸í•œ ìœ ì € ì •ë³´ ê°€ì ¸ì˜¤ê¸°)
      if (result.hasErrors())
         return ResponseEntity.badRequest().body(result.getAllErrors().getFirst().getDefaultMessage());
      
      if (userPrincipal == null)
         return ResponseEntity.status(HttpStatus.UNAUTHORIZED).body("ìœ íš¨í•˜ì§€ ì•Šì€ ì‚¬ìš©ìì…ë‹ˆë‹¤.");
      
      try {
         String email = userPrincipal.getEmail();
         Map<String, String> token = profileService.update(request, email); // âœ… Access Token ë°˜í™˜
         return ResponseEntity.ok(token); // âœ… JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µ
      } catch (IllegalArgumentException e) {
         return ResponseEntity.badRequest().body(e.getMessage());
      }
   }
   ```

   ```java
   public Map<String, String> update(@Valid ProfileEditRequest request, String email) {
      // ì´ë©”ì¼ë¡œ ì‚¬ìš©ì ì¡°íšŒ
      Account account = accountRepository.findByEmail(email)
         .orElseThrow(() -> new IllegalArgumentException("ì´ë©”ì¼ì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤."));
      
      // í”„ë¡œí•„ ì •ë³´ ì¡°íšŒ
      Profile profile = profileRepository.findByAccount(account)
         .orElseThrow(() -> new IllegalArgumentException("í”„ë¡œí•„ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."));
      
      // ë‹‰ë„¤ì„ ì¤‘ë³µ ì²´í¬
      if (!profile.getNickname().equals(request.getNickname()) && profileRepository.existsByNickname(request.getNickname())) {
         throw new IllegalArgumentException("ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.");
      }
      
      profile.setNickname(request.getNickname());
      profile.setImageUrl(request.getImageUrl());
      profile.setStatusMessage(request.getStatusMessage());
      profile.setUpdatedAt(LocalDateTime.now());
      
      profileRepository.save(profile);

      // ì‚¬ìš©ì ì •ë³´
      UserResponse userResponse = UserResponse.builder()
         .email(account.getEmail())
         .nickname(profile.getNickname())
         .imageUrl(profile.getImageUrl())
         .statusMessage(profile.getStatusMessage())
         .role(account.getRole())
         .build();
      
      String accessToken =  jwtUtil.generateAccessToken(userResponse);
      
      Map<String, String> token = new HashMap<>();
      token.put("accessToken", accessToken);
      
      return token;
   }
   ```

---
